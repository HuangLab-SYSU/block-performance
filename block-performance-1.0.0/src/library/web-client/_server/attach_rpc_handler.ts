// auto generated by dev/system
import express from "express";
import { Logger } from "../../../myutils/logger.js";
import { handle_rpc_get_file } from "../get-file/rpc/handle.js";
import { handle_rpc_get_file_temp } from "../get-file-temp/rpc/handle.js";
import { handle_rpc_get_json } from "../get-json/rpc/handle.js";
import { handle_rpc_get_text } from "../get-text/rpc/handle.js";
import { handle_rpc_head } from "../head/rpc/handle.js";
import { handle_rpc_post_json } from "../post-json/rpc/handle.js";
import { handle_rpc_proxy_url_parse } from "../proxy-url-parse/rpc/handle.js";

export function attach_rpc_handler(plog: Logger, opt: { router: express.Router }) {
    const log = plog.sub("server.attach_rpc_handler");
    const { router } = opt;

    router.post("/library/web-client/get-file", (req, res) => {
        const input = req.body;
        const req_log = log.sub("post.library.web-client.get-file");
        handle_rpc_get_file(req_log, input, {
            invalid_input: (err) => {
                // bad request
                req_log.error(err);
                res.status(400);
                res.end(err.message);
            },
            ok: (result) => {
                // include normal fail case
                req_log.variable("result", result);
                req_log.ok();
                res.json(result);
            },
            fail: (err) => {
                // internal error (not normal fail)
                req_log.error(err);
                res.status(500);
                res.end(err.message);
            }
        });
    });

    router.post("/library/web-client/get-file-temp", (req, res) => {
        const input = req.body;
        const req_log = log.sub("post.library.web-client.get-file-temp");
        handle_rpc_get_file_temp(req_log, input, {
            invalid_input: (err) => {
                // bad request
                req_log.error(err);
                res.status(400);
                res.end(err.message);
            },
            ok: (result) => {
                // include normal fail case
                req_log.variable("result", result);
                req_log.ok();
                res.json(result);
            },
            fail: (err) => {
                // internal error (not normal fail)
                req_log.error(err);
                res.status(500);
                res.end(err.message);
            }
        });
    });

    router.post("/library/web-client/get-json", (req, res) => {
        const input = req.body;
        const req_log = log.sub("post.library.web-client.get-json");
        handle_rpc_get_json(req_log, input, {
            invalid_input: (err) => {
                // bad request
                req_log.error(err);
                res.status(400);
                res.end(err.message);
            },
            ok: (result) => {
                // include normal fail case
                req_log.variable("result", result);
                req_log.ok();
                res.json(result);
            },
            fail: (err) => {
                // internal error (not normal fail)
                req_log.error(err);
                res.status(500);
                res.end(err.message);
            }
        });
    });

    router.post("/library/web-client/get-text", (req, res) => {
        const input = req.body;
        const req_log = log.sub("post.library.web-client.get-text");
        handle_rpc_get_text(req_log, input, {
            invalid_input: (err) => {
                // bad request
                req_log.error(err);
                res.status(400);
                res.end(err.message);
            },
            ok: (result) => {
                // include normal fail case
                req_log.variable("result", result);
                req_log.ok();
                res.json(result);
            },
            fail: (err) => {
                // internal error (not normal fail)
                req_log.error(err);
                res.status(500);
                res.end(err.message);
            }
        });
    });

    router.post("/library/web-client/head", (req, res) => {
        const input = req.body;
        const req_log = log.sub("post.library.web-client.head");
        handle_rpc_head(req_log, input, {
            invalid_input: (err) => {
                // bad request
                req_log.error(err);
                res.status(400);
                res.end(err.message);
            },
            ok: (result) => {
                // include normal fail case
                req_log.variable("result", result);
                req_log.ok();
                res.json(result);
            },
            fail: (err) => {
                // internal error (not normal fail)
                req_log.error(err);
                res.status(500);
                res.end(err.message);
            }
        });
    });

    router.post("/library/web-client/post-json", (req, res) => {
        const input = req.body;
        const req_log = log.sub("post.library.web-client.post-json");
        handle_rpc_post_json(req_log, input, {
            invalid_input: (err) => {
                // bad request
                req_log.error(err);
                res.status(400);
                res.end(err.message);
            },
            ok: (result) => {
                // include normal fail case
                req_log.variable("result", result);
                req_log.ok();
                res.json(result);
            },
            fail: (err) => {
                // internal error (not normal fail)
                req_log.error(err);
                res.status(500);
                res.end(err.message);
            }
        });
    });

    router.post("/library/web-client/proxy-url-parse", (req, res) => {
        const input = req.body;
        const req_log = log.sub("post.library.web-client.proxy-url-parse");
        handle_rpc_proxy_url_parse(req_log, input, {
            invalid_input: (err) => {
                // bad request
                req_log.error(err);
                res.status(400);
                res.end(err.message);
            },
            ok: (result) => {
                // include normal fail case
                req_log.variable("result", result);
                req_log.ok();
                res.json(result);
            },
            fail: (err) => {
                // internal error (not normal fail)
                req_log.error(err);
                res.status(500);
                res.end(err.message);
            }
        });
    });
}
