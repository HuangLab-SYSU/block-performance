// auto generated by dev/system

export { rpc_key_find } from "./rpc/client.js";
export { Input as KeyFindInput, Output as KeyFindOutput } from "./type.js";
export { make_input as make_key_find_input, make_output_empty as make_key_find_output_empty, make_output_ok as make_key_find_output_ok } from "./tool/index.js";

import { core } from "./core.js";
import { Logger } from "../../../myutils/logger.js";
import { Input, Output, Callback } from "./type.js";
import { logger_config } from "../_logger/index.js";

// [Note]
// Some libraries redefine the Input type with additional fields that cannot yet be expressed in the meta-type system.
// For example, the task-queue/task-add-wait/core module adds an additional "run" function.
// To support this use case, we should fetch the input type from the core function.
type InputEx = Parameters<typeof core>["1"];

export async function key_find<R>(plog: Logger, input: InputEx, cb: Callback<R>): Promise<R> {
    const log = plog.sub_library_function("x-ssh-key-control", "key-find");
    if (logger_config.disable_all) {
        log.enable(false);
    }
    try {
        log.variable("input", input);
        return await core(log, input, {
            empty: (output) => {
                log.println("empty");
                log.variable("output", output);
                return cb.empty(output);
            },
            ok: (output) => {
                log.println("ok");
                log.variable("output", output);
                return cb.ok(output);
            },
            fail: (err) => {
                log.println("fail");
                log.print_unknown_error(err);
                return cb.fail(err);
            }
        });
    } catch (err) {
        log.print_unknown_error(err);
        return cb.fail(err);
    }
}
